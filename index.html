<!DOCTYPE html>
<html lang="es">
<head>
    <!-- Meta tags y título (mantener igual) -->
    <style>
        /* Estilos CSS (mantener igual) */
    </style>
</head>
<body>
    <!-- Estructura HTML (mantener igual) -->

    <script>
        // Variables de estado (mantener igual)
        
        // Nuevo: Formateador de números profesional
        const numberFormatter = new Intl.NumberFormat('en-US', {
            maximumFractionDigits: 8,
            useGrouping: true
        });

        // Modificar updateDisplay para formatear números
        function updateDisplay() {
            let displayValue = currentValue;
            
            // Solo formatear si es un número completo (no durante entrada decimal)
            if (!isNaN(currentValue) && !currentValue.endsWith('.')) {
                try {
                    displayValue = numberFormatter.format(parseFloat(currentValue));
                } catch (e) {
                    console.error("Error al formatear número:", e);
                }
            }
            
            display.querySelector('span').textContent = displayValue;
        }

        // Modificar appendNumber para manejar entrada con comas
        function appendNumber(number) {
            if (currentValue === '0' || resetScreen) {
                currentValue = '';
                resetScreen = false;
            }
            
            // Eliminar comas existentes para la nueva entrada
            currentValue = currentValue.replace(/,/g, '') + number;
            updateDisplay();
        }

        // Modificar calculate para manejar comas en cálculos
        function calculate() {
            let result;
            // Eliminar comas antes de calcular
            const prev = parseFloat(previousValue.replace(/,/g, ''));
            const current = parseFloat(currentValue.replace(/,/g, ''));
            
            if (isNaN(prev) || isNaN(current)) return;
            
            switch (operation) {
                case '+': result = prev + current; break;
                case '−': result = prev - current; break;
                case '×': result = prev * current; break;
                case '÷': result = prev / current; break;
                default: return;
            }
            
            currentValue = result.toString();
            operation = null;
            resetScreen = true;
            operationBtns.forEach(btn => btn.classList.remove('operator-active'));
            updateDisplay();
        }

        // Modificar toggleSign y percentage para manejar comas
        function toggleSign() {
            const number = parseFloat(currentValue.replace(/,/g, ''));
            currentValue = (number * -1).toString();
            updateDisplay();
        }

        function percentage() {
            const number = parseFloat(currentValue.replace(/,/g, ''));
            currentValue = (number / 100).toString();
            updateDisplay();
        }

        // Modificar backspace para manejar comas
        function backspace() {
            // Eliminar comas temporalmente
            let tempValue = currentValue.replace(/,/g, '');
            
            if (tempValue.length === 1 || (tempValue.length === 2 && tempValue.startsWith('-'))) {
                currentValue = '0';
            } else {
                tempValue = tempValue.slice(0, -1);
                currentValue = tempValue === '' ? '0' : tempValue;
            }
            
            updateDisplay();
        }

        // Resto del código (mantener igual)
    </script>
</body>
</html>
